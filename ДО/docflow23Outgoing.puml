@startuml Docflows 23 outgoing StateMachine
state "Ожидается подтверждение оператора" as WaitingOperatorAproove
state "Ожидается ИоП" as WaitingInvoice
state "Ожидается ответная подпись" as WaitingAnswer
state "Завершён" as Copmleted
state "Отклонён" as Rejected
state "Подписывается" as Signing
state "Готов к отправке" as ReadyToSend
state ResponsreSignatureRequired <<choice>>

[*] --> ReadyToSend : Первичный документ загружен
ReadyToSend --> Signing : Отправить первичный документ
Signing --> ReadyToSend : Ошибка подписания
Signing --> WaitingOperatorAproove : Первичный документ отправлен
WaitingOperatorAproove --> WaitingInvoice : Получен ПДП
WaitingInvoice --> ResponsreSignatureRequired 
ResponsreSignatureRequired --> WaitingAnswer : Получен ИоП (требуется ответная подпись)
ResponsreSignatureRequired --> Copmleted : Получен ИоП (ответная подпись не требуется)
WaitingAnswer --> Copmleted : Получено согласие с первичкой

Copmleted --> [*]
note left of Copmleted : Аннулирование расписано   \nна отдельной диаграмме \n Аннулирование недоступно если \n 
note left of Copmleted : Аннулирование недоступно если \n ответная подпись не требовалась.

Copmleted --> Rejected : Получен УоУ
WaitingAnswer --> Rejected : Получено УоУ на первичку
Rejected --> [*]

@enduml